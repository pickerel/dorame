var saaa_updater=function(B,A){this.version_check_url=B;this._update_url=null;this.filename=A;this.need_update_or_not_handle=null;this.error_handle=null;this.update_ok_handle=null;this.update_process_handle=null;this.lastest_version_info={};this._currentVersionInfo={}};saaa_updater.prototype.need_update=function(){var B=parseFloat(this.lastest_version_info.version);var A=parseFloat(this._currentVersionInfo.version);if(B-A>1e-8){return true}return false};saaa_updater.prototype.check=function(){try{var C=(new DOMParser()).parseFromString(air.NativeApplication.nativeApplication.applicationDescriptor,"text/xml");this._currentVersionInfo.name=C.getElementsByTagName("name")[0].childNodes[0].data;this._currentVersionInfo.version=C.getElementsByTagName("version")[0].childNodes[0].data;air.trace("current application version:"+this._currentVersionInfo.version);var A=this;air.trace("checking the url:"+this.version_check_url);$.ajax({type:"GET",url:this.version_check_url,dataType:"text",success:function(D){air.trace("lastest version xml:"+D);C=(new DOMParser()).parseFromString(D,"text/xml");A.lastest_version_info.releasenotes=C.getElementsByTagName("releasenotes")[0].childNodes[0].data;A.lastest_version_info.version=C.getElementsByTagName("latestversion")[0].childNodes[0].data;A._update_url=C.getElementsByTagName("downloadurl")[0].childNodes[0].data;air.trace("lastest application version:"+A.lastest_version_info.version);if(A.need_update_or_not_handle!=null){A.need_update_or_not_handle(A.need_update())}},error:function(D,F,E){if(F=="error"){if(A.error_handle){A.error_handle("","establishing connection with update site")}}else{if(A.error_handle){A.error_handle("","retrieving data from update site")}}}})}catch(B){air.trace("update error:"+B);if(this.error_handle!=null){this.error_handle(B,"checking for newer version")}}};saaa_updater.prototype.update=function(){try{var D=this;air.trace("updating...");var C=function(H){var G=Math.round((H.bytesLoaded/H.bytesTotal)*100);air.trace("updating:"+G);if(D.update_process_handle!=null){D.update_process_handle(G)}};var A=air.File.applicationStorageDirectory.resolvePath(this.filename);var B=function(){try{var H=new air.ByteArray();stream.readBytes(H,0,stream.bytesAvailable);fileStream=new air.FileStream();fileStream.addEventListener(air.Event.CLOSE,E);fileStream.openAsync(A,air.FileMode.WRITE);fileStream.writeBytes(H,0,H.length);fileStream.close()}catch(G){air.trace(G);if(D.error_handle){D.error_handle(G,"updating")}}};var E=function(){try{var H=new air.Updater();H.update(A,D.lastest_version_info.version);if(D.update_ok_handle!=null){D.update_ok_handle()}if(D.updateCompletehandle){D.updateCompletehandle()}}catch(G){air.trace(G);if(D.error_handle){D.error_handle(G,"installing")}}};stream=new air.URLStream();stream.addEventListener(air.ProgressEvent.PROGRESS,C);stream.addEventListener(air.Event.COMPLETE,B);air.trace("updating from url:"+this._update_url);stream.load(new air.URLRequest(this._update_url))}catch(F){air.trace("update failed:"+F);if(D.error_handle){D.error_handle(F,"processing update")}}};